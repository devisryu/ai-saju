<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AI ì‚¬ì£¼ â€” ì˜¤ëŠ˜ ìš´ì„¸</title>
<meta name="description" content="ìƒë…„ì›”ì¼/ì‹œê°„ë§Œìœ¼ë¡œ ì˜¤ëŠ˜ ìš´ì„¸, í•œë‹¬ ìš´ì„¸, ì¬ë¬¼ìš´, ì—°ì• ìš´, ê¶í•©, ë¡œë˜ë²ˆí˜¸ ì¶”ì²œê¹Œì§€ AIë¡œ ê°„ë‹¨ í™•ì¸" />
<style>
:root { --bg:#0b0f14; --card:#121823; --ink:#e7eefb; --muted:#a9b7d0; --accent:#7cc3ff; }
html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, sans-serif}
.wrap{max-width:780px;margin:0 auto;padding:16px 16px 96px}
header{display:flex;justify-content:space-between;align-items:center;margin:6px 0 16px}
.brand{font-weight:700;letter-spacing:.3px}
.card{background:var(--card);border-radius:16px;padding:16px;margin:12px 0;box-shadow:0 10px 30px rgba(0,0,0,.25)}
label{display:block;font-size:.9rem;color:var(--muted);margin:8px 0 4px}
input,select{width:100%;background:#0e1420;color:var(--ink);border:1px solid #1d2738;border-radius:10px;padding:12px;outline:none}
.row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.actions{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
.btn{background:#1a2536;border:1px solid #22324a;color:var(--ink);padding:10px 12px;border-radius:12px;cursor:pointer}
.btn.primary{background:linear-gradient(180deg,#2a64ff,#1846ff);border:none}
.btn.ghost{background:transparent;border:1px dashed #334563;color:#bcd3ff}
.tabs{display:flex;gap:8px;flex-wrap:wrap;margin-top:4px}
.tab{background:#101725;border:1px solid #23324a;color:#cfe2ff;padding:8px 10px;border-radius:999px;font-size:.92rem;cursor:pointer}
.tab.active{outline:2px solid var(--accent);}
.result{white-space:pre-wrap;line-height:1.6}
.muted{color:var(--muted);font-size:.92rem}
.ad{display:flex;justify-content:center;align-items:center;height:60px;background:#0e1420;border:1px dashed #334563;border-radius:12px;color:#8aa3c7;font-size:.9rem}
.share{display:flex;gap:8px}
footer.banner{position:fixed;left:0;right:0;bottom:0;background:#0c111b;border-top:1px solid #1d2738;padding:8px}
.foot-inner{max-width:780px;margin:0 auto}
.small{font-size:.82rem}
</style>
</head>
<body>
<div class="wrap">
<header>
<div class="brand">ğŸ”® AI ì‚¬ì£¼</div>
<button class="btn ghost small" id="btn-pwa">í™ˆí™”ë©´ ì¶”ê°€</button>
</header>


<div class="card">
<div class="muted">ìµœì†Œ ì •ë³´ë§Œ ì…ë ¥</div>
<div class="row">
<div>
<label>ìƒë…„ì›”ì¼</label>
<input type="date" id="birthDate" required />
</div>
<div>
<label>íƒœì–´ë‚œ ì‹œê°„ (ëª¨ë¥´ë©´ 00:00)</label>
<input type="time" id="birthTime" value="00:00" />
</div>
</div>
<details style="margin-top:8px">
<summary>ê¶í•©(ì„ íƒ) â€” ìƒëŒ€ ì •ë³´ ì…ë ¥</summary>
<div class="row" style="margin-top:8px">
<div>
<label>ìƒëŒ€ ìƒë…„ì›”ì¼</label>
<input type="date" id="partnerDate" />
</div>
<div>
<label>ìƒëŒ€ íƒœì–´ë‚œ ì‹œê°„</label>
<input type="time" id="partnerTime" value="00:00" />
</div>
</div>
</details>


<div class="tabs" id="tabs">
<button class="tab active" data-type="today">ì˜¤ëŠ˜ ìš´ì„¸</button>
<button class="tab" data-type="month">í•œë‹¬ ìš´ì„¸</button>
<button class="tab" data-type="wealth">ì¬ë¬¼ìš´</button>
<button class="tab" data-type="love">ì—°ì• /ê²°í˜¼ìš´</button>
<button class="tab" data-type="lotto">ë¡œë˜ ë²ˆí˜¸</button>
<button class="tab" data-type="match">ê¶í•©</button>
</div>


<div class="actions">
<button class="btn primary" id="btn-go">ë¶„ì„í•˜ê¸°</button>
<button class="btn" id="btn-share">ê³µìœ í•˜ê¸°</button>
</div>

<script>
  // ì½˜ì†” ì—ëŸ¬ê°€ ìˆìœ¼ë©´ ì „ì²´ ìŠ¤í¬ë¦½íŠ¸ê°€ ë©ˆì¶”ê¸° ë•Œë¬¸ì— ì œì¼ ë¨¼ì € ê°ì§€
  window.addEventListener('error', (e) => {
    console.warn('[JS ERROR]', e.message);
  });

  document.addEventListener('DOMContentLoaded', () => {
    console.log('[READY] DOM loaded');

    const btnGo = document.getElementById('btn-go');
    const result = document.getElementById('result');
    const birthDateEl = document.getElementById('birthDate');
    const birthTimeEl = document.getElementById('birthTime');
    const partnerDateEl = document.getElementById('partnerDate');
    const partnerTimeEl = document.getElementById('partnerTime');

    // íƒ­ ìƒíƒœ (ì—†ìœ¼ë©´ today ê¸°ë³¸)
    let currentType = 'today';
    const tabs = document.querySelectorAll('.tab');
    if (tabs.length) {
      tabs.forEach(t => t.addEventListener('click', () => {
        tabs.forEach(x => x.classList.remove('active'));
        t.classList.add('active');
        currentType = t.dataset.type || 'today';
      }));
    }

    // í´ë¦­ ì´ë²¤íŠ¸ê°€ ì •ë§ë¡œ ê±¸ë ¸ëŠ”ì§€ ë¡œê·¸/ì•Œë¦¼ìœ¼ë¡œ ê²€ì¦
    btnGo?.addEventListener('click', async () => {
      console.log('[CLICK] ë¶„ì„í•˜ê¸° pressed');
      // 1ë‹¨ê³„: í´ë¦­ ë°˜ì‘ í™•ì¸ìš©
      // alert('í´ë¦­ OK'); // í•„ìš”í•˜ë©´ ì ê¹ ì£¼ì„ í•´ì œí•´ì„œ í™•ì¸

      const birthDate = birthDateEl?.value;
      const birthTime = birthTimeEl?.value || '00:00';
      const partnerDate = partnerDateEl?.value;
      const partnerTime = partnerTimeEl?.value || '00:00';

      if (!birthDate) { alert('ìƒë…„ì›”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.'); return; }
      if (currentType === 'match' && !partnerDate) { alert('ê¶í•©ì€ ìƒëŒ€ ìƒë…„ì›”ì¼ì´ í•„ìš”í•©ë‹ˆë‹¤.'); return; }

      result.textContent = 'ğŸ”® í•´ì„ ì¤‘...';

      // lottoëŠ” í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì²˜ë¦¬
      if (currentType === 'lotto') {
        const nums = Array.from({length:45}, (_,i)=>i+1)
          .sort(() => Math.random() - 0.5)
          .slice(0,6).sort((a,b)=>a-b);
        result.textContent = `ì´ë²ˆ ì£¼ ì°¸ê³ ìš© ë²ˆí˜¸\n${nums.join(' Â· ')}\n(ì—”í„°í…Œì¸ë¨¼íŠ¸ ëª©ì , ì±…ì„ ì‚¬ìš©)`;
        return;
      }

      try {
        const payload = { type: currentType, birthDate, birthTime, partnerDate, partnerTime, tz: 'Asia/Seoul' };
        console.log('[FETCH] POST /api/saju', payload);
        const res = await fetch('/api/saju', {
          method: 'POST',
          headers: { 'content-type': 'application/json' },
          body: JSON.stringify(payload),
        });
        if (!res.ok) {
          const txt = await res.text();
          console.warn('API fail', res.status, txt);
          throw new Error('API ì‹¤íŒ¨: ' + res.status);
        }
        const data = await res.json();
        result.textContent = data.text || 'í•´ì„ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.';
      } catch (e) {
        console.error(e);
        result.textContent = '[ë¡œì»¬ Fallback] ì˜¤ëŠ˜ì€ ì°¨ë¶„í•˜ê²Œ ì»¨ë””ì…˜ ì¡°ì ˆì— ì§‘ì¤‘í•˜ì„¸ìš”. ì¤‘ìš”í•œ ê²°ì •ì€ ë‚´ì¼ë¡œ ë¯¸ë£¨ëŠ” ê²ƒë„ ë°©ë²•ì…ë‹ˆë‹¤.';
      }
    });
  });
</script>
  
</html>
