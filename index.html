<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI ì‚¬ì£¼ â€” ì˜¤ëŠ˜ ìš´ì„¸</title>
  <style>
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, sans-serif; background:#0b0f14; color:#e7eefb; }
    .wrap { max-width: 720px; margin: 0 auto; padding: 16px 16px 120px; }
    .card { background:#121823; border-radius:16px; padding:16px; margin:12px 0; }
    .row { display:grid; grid-template-columns:1fr 1fr; gap:10px }
    label { display:block; font-size:.9rem; color:#a9b7d0; margin:8px 0 4px }
    input { width:100%; background:#0e1420; color:#e7eefb; border:1px solid #1d2738; border-radius:10px; padding:12px; outline:none }
    .actions { display:flex; gap:8px; margin-top:12px; flex-wrap:wrap }
    .btn { background:#1a2536; border:1px solid #22324a; color:#fff; padding:10px 12px; border-radius:12px; cursor:pointer }
    .btn.primary { background:linear-gradient(180deg,#2a64ff,#1846ff); border:none }
    .tabbar { display:flex; gap:8px; flex-wrap:wrap; margin-top:8px }
    .tab { background:#101725; border:1px solid #23324a; color:#cfe2ff; padding:8px 10px; border-radius:999px; font-size:.92rem; cursor:pointer }
    .tab.active { outline:2px solid #7cc3ff; }
    .result { white-space:pre-wrap; line-height:1.6 }
    footer.banner { position:fixed; left:0; right:0; bottom:0; background:#0c111b; border-top:1px solid #1d2738; padding:8px; z-index: 1; }
    .ad { height:48px; display:flex; align-items:center; justify-content:center; border:1px dashed #334563; color:#8aa3c7; border-radius:12px }
    .actions, .card { position: relative; z-index: 2; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div style="color:#a9b7d0">ìµœì†Œ ì •ë³´ë§Œ ì…ë ¥</div>
      <div class="row">
        <div>
          <label>ìƒë…„ì›”ì¼</label>
          <input type="date" id="birthDate" />
        </div>
        <div>
          <label>íƒœì–´ë‚œ ì‹œê°„ (ëª¨ë¥´ë©´ 00:00)</label>
          <input type="time" id="birthTime" value="00:00" />
        </div>
      </div>

      <div class="tabbar" id="tabs">
        <button class="tab active" data-type="today" type="button">ì˜¤ëŠ˜</button>
        <button class="tab" data-type="month" type="button">í•œë‹¬</button>
        <button class="tab" data-type="wealth" type="button">ì¬ë¬¼</button>
        <button class="tab" data-type="love" type="button">ì—°ì• /ê²°í˜¼</button>
        <button class="tab" data-type="lotto" type="button">ë¡œë˜</button>
        <button class="tab" data-type="match" type="button">ê¶í•©</button>
      </div>

      <div class="actions">
        <button class="btn primary" id="btn-go" type="button">ë¶„ì„í•˜ê¸°</button>
        <button class="btn" id="btn-share" type="button">ê³µìœ í•˜ê¸°</button>
      </div>

      <div class="ad" style="margin-top:12px">[ê´‘ê³  ìë¦¬]</div>
    </div>

    <div class="card">
      <div style="color:#a9b7d0">ê²°ê³¼</div>
      <div id="result" class="result">ì…ë ¥ í›„ [ë¶„ì„í•˜ê¸°]ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>
    </div>
  </div>

  <footer class="banner">
    <div class="ad">[í•˜ë‹¨ ê³ ì • ë°°ë„ˆ]</div>
  </footer>

  <script>
    window.addEventListener('error', e => console.warn('[JS ERROR]', e.message));

    document.addEventListener('DOMContentLoaded', () => {
      console.log('[READY] DOM loaded');

      const result = document.getElementById('result');
      const btnGo = document.getElementById('btn-go');
      const btnShare = document.getElementById('btn-share');
      const birthDateEl = document.getElementById('birthDate');
      const birthTimeEl = document.getElementById('birthTime');

      let currentType = 'today';
      const tabs = document.querySelectorAll('.tab');
      tabs.forEach(t => t.addEventListener('click', () => {
        tabs.forEach(x => x.classList.remove('active'));
        t.classList.add('active');
        currentType = t.dataset.type || 'today';
        console.log('[TAB]', currentType);
      }));

      btnGo.addEventListener('click', async () => {
        console.log('[CLICK] ë¶„ì„í•˜ê¸° pressed');
        if (!result) { alert('ê²°ê³¼ ì˜ì—­(#result)ì´ ì—†ìŠµë‹ˆë‹¤.'); return; }

        const birthDate = birthDateEl.value;
        const birthTime = birthTimeEl.value || '00:00';

        if (!birthDate) { alert('ìƒë…„ì›”ì¼ ì…ë ¥'); return; }

        if (currentType === 'lotto') {
          const nums = Array.from({length:45}, (_,i)=>i+1).sort(()=>Math.random()-0.5).slice(0,6).sort((a,b)=>a-b);
          result.textContent = `ì´ë²ˆ ì£¼ ì°¸ê³ ìš© ë²ˆí˜¸\n${nums.join(' Â· ')}\n(ì—”í„°í…Œì¸ë¨¼íŠ¸ ëª©ì )`;
          return;
        }

        result.textContent = 'ğŸ”® í•´ì„ ì¤‘...';
        try {
          const payload = { type: currentType, birthDate, birthTime, tz:'Asia/Seoul' };
          console.log('[FETCH] POST /api/saju', payload);
          const r = await fetch('/api/saju', {
            method: 'POST',
            headers: { 'content-type': 'application/json' },
            body: JSON.stringify(payload)
          });
          const txt = await r.text();
          console.log('[RESP]', r.status, txt);
          let data; try { data = JSON.parse(txt); } catch {}
          if (!r.ok) throw new Error(txt || 'API ì‹¤íŒ¨');
          result.textContent = (data && data.text) ? data.text : 'ê²°ê³¼ê°€ ë¹„ì—ˆìŠµë‹ˆë‹¤.';
        } catch (e) {
          console.error(e);
          result.textContent = '[ë¡œì»¬ Fallback] ì˜¤ëŠ˜ì€ ë¬´ë¦¬í•˜ì§€ ë§ê³  ê¸°ë³¸ì— ì¶©ì‹¤í•œ í•˜ë£¨ê°€ ì¢‹ìŠµë‹ˆë‹¤.';
        }
      });

      btnShare.addEventListener('click', async () => {
        const text = result.textContent || 'AI ì‚¬ì£¼ì—ì„œ ì˜¤ëŠ˜ ìš´ì„¸ í™•ì¸!';
        try {
          if (navigator.share) await navigator.share({ title:'AI ì‚¬ì£¼', text, url: location.href });
          else { await navigator.clipboard.writeText(location.href); alert('ì£¼ì†Œë¥¼ ë³µì‚¬í–ˆìŠµë‹ˆë‹¤.'); }
        } catch {}
      });
    });
  </script>
</body>
</html>
